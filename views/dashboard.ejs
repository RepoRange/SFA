<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Farming Assistant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-white">
    <!-- Navigation with consistent spacing -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
          <div class="flex items-center space-x-2">
            <svg
              class="h-8 w-8 text-green-600"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
            </svg>
            <span class="text-xl font-bold text-gray-900"
              >Smart Farming Assistant</span
            >
          </div>

          <!-- Navigation Links (Always visible) -->
          <div class="hidden md:flex space-x-8">
            <a href="#features" class="text-gray-600 hover:text-green-600"
              >Features</a
            >
            <a href="#benefits" class="text-gray-600 hover:text-green-600"
              >Benefits</a
            >
            <a href="#contact" class="text-gray-600 hover:text-green-600"
              >Contact</a
            >
          </div>

          <!-- User Profile Section -->
          <div
            id="userProfile"
            class="flex items-center space-x-4 cursor-pointer"
          >
            <img
              id="userAvatar"
              class="h-8 w-8 rounded-full"
              src="<%= user.avatar || 'https://em-content.zobj.net/thumbs/240/apple/354/seedling_1f331.png' %>"
              alt="User Avatar"
            />
            <span id="userName" class="text-gray-800"><%= user.name %></span>
          </div>

          <!-- Dropdown Card (Initially Hidden) -->
          <!-- Dropdown Card (Initially Hidden) -->
          <div
            id="userInfoCard"
            class="absolute top-16 right-4 bg-white shadow-xl rounded-lg p-8 hidden w-96 max-w-full overflow-hidden"
          >
            <div class="flex items-center space-x-5 mb-5">
              <!-- Avatar Section -->
              <img
                id="cardAvatar"
                class="h-20 w-20 rounded-full object-cover"
                src="https://em-content.zobj.net/thumbs/240/apple/354/seedling_1f331.png"
                alt="User Avatar"
              />
              <div>
                <!-- User Name -->
                <p
                  id="cardUserName"
                  class="font-semibold text-gray-800 text-2xl"
                >
                  Username
                </p>
                <!-- User Email -->
                <p id="cardEmail" class="text-md text-gray-600">
                  user@example.com
                </p>
              </div>
            </div>
            <!-- Logout Button -->
            <button
              id="logoutBtn"
              class="mt-4 w-full bg-gray-100 text-gray-700 py-3 rounded-md hover:bg-gray-200 border border-gray-300 transition-all duration-200 font-medium"
            >
              <span class="flex items-center justify-center">
                <svg
                  class="w-5 h-5 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                  />
                </svg>
                Logout
              </span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section with consistent padding -->
    <section class="relative bg-gradient-to-r from-green-50 to-green-100">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <div class="space-y-6">
            <h1 class="text-4xl md:text-6xl font-bold text-gray-900">
              Transform Your Farm with AI
            </h1>
            <p class="text-xl text-gray-600">
              Optimize yields, reduce costs, and make data-driven decisions with
              our smart farming solution
            </p>
            <div class="pt-4">
              <a
                href="#features"
                class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition-colors inline-block text-lg"
              >
                Learn More
              </a>
            </div>
          </div>
          <div class="rounded-xl overflow-hidden shadow-xl">
            <img
              src="https://cdn.pixabay.com/photo/2021/08/08/10/02/farmer-6530444_640.jpg"
              alt="Smart farming dashboard"
              class="w-full h-full object-cover"
            />
          </div>
        </div>
      </div>
    </section>
    <section class="py-20 bg-gray-50" id="features">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-center text-gray-900 mb-12">
          Our Features
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <!-- Feature Card 1 -->
          <div
            class="rounded-xl bg-white shadow-lg hover:shadow-xl transition-shadow overflow-hidden"
          >
            <div class="relative h-48 w-full">
              <img
                src="https://cdn.pixabay.com/photo/2019/07/22/08/59/market-4354598_1280.jpg"
                alt="Real-time crop prices"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="p-6 text-center">
              <a
                href="/api/crop-prices_form"
                class="text-xl font-semibold text-green-600 hover:underline transition block"
              >
                Real-Time Crop Prices
              </a>
              <p class="text-gray-600 mt-2">
                Get the latest crop prices from your nearest agricultural
                market.
              </p>
            </div>
          </div>

          <!-- Feature Card 2 -->
          <div
            class="rounded-xl bg-white shadow-lg hover:shadow-xl transition-shadow overflow-hidden"
          >
            <div class="relative h-48 w-full">
              <img
                src="https://cdn.pixabay.com/photo/2019/02/05/20/00/anemometer-3977718_1280.jpg"
                alt="Weather monitoring"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="p-6 text-center">
              <a
                href="/api/weather"
                class="text-xl font-semibold text-blue-600 hover:underline transition block"
              >
                Weather Integration
              </a>
              <p class="text-gray-600 mt-2">
                Smart forecasting to make informed decisions.
              </p>
            </div>
          </div>

          <!-- Feature Card 3 -->
          <div
            class="rounded-xl bg-white shadow-lg hover:shadow-xl transition-shadow overflow-hidden"
          >
            <div class="relative h-48 w-full">
              <img
                src="https://cdn.pixabay.com/photo/2022/06/07/03/25/rice-fields-7247360_640.jpg"
                alt="Crop calendar"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="p-6 text-center">
              <a
                href="/api/crop-calendar"
                class="text-xl font-semibold text-purple-600 hover:underline transition block"
              >
                Crop Calendar
              </a>
              <p class="text-gray-600 mt-2">
                Maximize productivity with data-driven Calendar for the crop.
              </p>
            </div>
          </div>

          <!-- Feature Card 4 -->
          <div
            class="rounded-xl bg-white shadow-lg hover:shadow-xl transition-shadow overflow-hidden"
          >
            <div class="relative h-48 w-full">
              <img
                src="https://cdn.pixabay.com/photo/2019/04/17/11/12/catch-crop-4133942_1280.jpg"
                alt="pest protection"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="p-6 text-center">
              <a
                href="#"
                class="text-xl font-semibold text-red-600 hover:underline transition block"
                id="uploadLink"
              >
                Pest Protection
              </a>
              <p class="text-gray-600 mt-2">
                Early warning system for pest detection.
              </p>
            </div>
          </div>

          <!-- Upload Dialog (Initially Hidden) -->
          <div
            id="uploadDialog"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
          >
            <div
              class="bg-white rounded-xl p-8 max-w-md w-full mx-4 transform transition-all"
            >
              <div class="text-center">
                <svg
                  class="mx-auto h-12 w-12 text-red-600 mb-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  />
                </svg>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">
                  Upload Leaf Image
                </h3>
                <p class="text-gray-600 mb-6">
                  Please upload a clear picture of the diseased leaf for
                  analysis
                </p>

                <button
                  id="uploadButton"
                  class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors duration-200 font-medium"
                >
                  Upload Image
                </button>

                <button
                  id="closeDialog"
                  class="mt-4 text-gray-500 hover:text-gray-700 block w-full text-sm"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer with consistent spacing -->
    <footer class="bg-gray-900 text-gray-300">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
          <!-- Company Info -->
          <div class="space-y-4">
            <div class="flex items-center">
              <svg
                class="h-6 w-6 text-green-500"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
              </svg>
              <span class="ml-2 text-lg font-bold text-white"
                >Smart Farming Assistant</span
              >
            </div>
            <p class="text-sm">
              Revolutionizing agriculture through intelligent technology and
              data-driven insights
            </p>
          </div>

          <!-- Contact Info -->
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Contact Us</h3>
            <div class="space-y-3">
              <p class="flex items-center">
                <svg
                  class="h-4 w-4 mr-2"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  />
                </svg>
                info@smartfarming.ai
              </p>
              <p class="flex items-center">
                <svg
                  class="h-4 w-4 mr-2"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                  />
                </svg>
                +1 (555) 123-4567
              </p>
              <p class="flex items-center">
                <svg
                  class="h-4 w-4 mr-2"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                  />
                  <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                123 AgTech Valley, CA 94025
              </p>
            </div>
          </div>

          <!-- Quick Links -->
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Quick Links</h3>
            <ul class="space-y-3">
              <li>
                <a href="#" class="hover:text-green-500 transition-colors"
                  >About Us</a
                >
              </li>
              <li>
                <a href="#" class="hover:text-green-500 transition-colors"
                  >Our Services</a
                >
              </li>
              <li>
                <a href="#" class="hover:text-green-500 transition-colors"
                  >Case Studies</a
                >
              </li>
              <li>
                <a href="#" class="hover:text-green-500 transition-colors"
                  >Support Center</a
                >
              </li>
            </ul>
          </div>

          <!-- Newsletter -->
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">Stay Updated</h3>
            <p class="mb-4">
              Subscribe to our newsletter for the latest agricultural insights
              and technology updates
            </p>
            <div class="flex items-center space-x-2">
              <input
                type="email"
                placeholder="Enter your email"
                class="px-4 py-2 rounded-lg bg-gray-800 text-white w-full focus:outline-none focus:ring-2 focus:ring-green-500"
              />
            </div>
          </div>
        </div>

        <!-- Bottom Footer -->
        <div class="border-t border-gray-800 mt-12 pt-8">
          <div class="flex flex-col md:flex-row justify-between items-center">
            <p class="text-sm">
              © 2024 Smart Farming Assistant. All rights reserved.
            </p>
            <div class="flex space-x-6 mt-4 md:mt-0">
              <a href="#" class="hover:text-green-500 transition-colors"
                >Privacy Policy</a
              >
              <a href="#" class="hover:text-green-500 transition-colors"
                >Terms of Service</a
              >
              <a href="#" class="hover:text-green-500 transition-colors"
                >Cookie Policy</a
              >
            </div>
          </div>
        </div>
      </div>
    </footer>
    <input type="file" id="fileInput" style="display: none" />
    <!-- Logout Confirmation Modal (Initially Hidden) -->
    <div
      id="logoutModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50"
    >
      <div
        class="bg-white rounded-lg p-8 max-w-sm w-full mx-4 transform transition-all"
      >
        <div class="text-center">
          <svg
            class="mx-auto h-12 w-12 text-gray-600 mb-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
            />
          </svg>
          <h3 class="text-xl font-semibold text-gray-900 mb-2">
            Confirm Logout
          </h3>
          <p class="text-gray-600 mb-6">Are you sure you want to log out?</p>
          <div class="flex justify-center space-x-4">
            <button
              id="confirmLogout"
              class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition-colors duration-200"
            >
              Yes, Logout
            </button>
            <button
              id="cancelLogout"
              class="bg-gray-100 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-200 border border-gray-300 transition-colors duration-200"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Function to fetch user info from the backend
        function fetchUserInfo() {
          fetch("/api/user-info", {
            method: "GET",
            credentials: "include",
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
      
              document.getElementById("cardAvatar").src =
                // data.avatar ||
                "https://em-content.zobj.net/thumbs/240/apple/354/seedling_1f331.png";

              document.getElementById("cardUserName").textContent = data.name;

              document.getElementById("cardEmail").textContent = data.email;
            })
            .catch((error) => {
              console.error("Error fetching user info:", error);
            });
        }

        // Fetch user info when the page loads
        fetchUserInfo();

        // Handle profile click to toggle the dropdown menu visibility
        const userProfile = document.getElementById("userProfile");
        const userInfoCard = document.getElementById("userInfoCard");

        userProfile.addEventListener("click", () => {
          // Toggle visibility of the dropdown card
          userInfoCard.classList.toggle("hidden");
        });

        // Logout handling
        const logoutBtn = document.getElementById("logoutBtn");
        const logoutModal = document.getElementById("logoutModal");
        const confirmLogout = document.getElementById("confirmLogout");
        const cancelLogout = document.getElementById("cancelLogout");

        // Show logout modal
        logoutBtn.addEventListener("click", () => {
          logoutModal.classList.remove("hidden");
          logoutModal.classList.add("flex");
        });

        // Handle modal close
        cancelLogout.addEventListener("click", () => {
          logoutModal.classList.add("hidden");
          logoutModal.classList.remove("flex");
        });

        // Handle logout confirmation
        confirmLogout.addEventListener("click", () => {
          fetch("/auth/logout", {
            method: "POST",
            credentials: "include",
          })
            .then(() => {
              window.location.href = "/";
            })
            .catch((error) => {
              console.error("Error logging out:", error);
            });
        });

        // Close modal when clicking outside
        logoutModal.addEventListener("click", (event) => {
          if (event.target === logoutModal) {
            logoutModal.classList.add("hidden");
            logoutModal.classList.remove("flex");
          }
        });
      });

      const uploadLink = document.getElementById("uploadLink");
      const fileInput = document.getElementById("fileInput");
      const uploadDialog = document.getElementById("uploadDialog");
      const uploadButton = document.getElementById("uploadButton");
      const closeDialog = document.getElementById("closeDialog");

      // Show dialog when Pest Protection is clicked
      uploadLink.addEventListener("click", function (event) {
        event.preventDefault();
        uploadDialog.classList.remove("hidden");
      });

      // Hide dialog when Cancel is clicked
      closeDialog.addEventListener("click", function () {
        uploadDialog.classList.add("hidden");
      });

      // Trigger file input when Upload Image button is clicked
      uploadButton.addEventListener("click", function () {
        fileInput.click();
      });

      // Close dialog when clicking outside
      uploadDialog.addEventListener("click", function (event) {
        if (event.target === uploadDialog) {
          uploadDialog.classList.add("hidden");
        }
      });

      // Handle file selection
      fileInput.addEventListener("change", function () {
        const file = fileInput.files[0];
        uploadDialog.classList.add("hidden"); // Hide dialog after file selection

        if (file) {
          const formData = new FormData();
          formData.append("file", file);

          fetch("/api/upload-endpoint", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              console.log("Disease Type:", data.diseaseType);
              if (data.diseaseType) {
                window.location.href = `/api/pest_result?disease=${encodeURIComponent(
                  data.diseaseType
                )}`;
              } else {
                alert("Failed to detect disease. Please try again.");
              }
            })
            .catch((error) => {
              console.error("Error uploading file:", error);
              alert("Error uploading file.");
            });
        }
      });
    </script>
  </body>
</html>
